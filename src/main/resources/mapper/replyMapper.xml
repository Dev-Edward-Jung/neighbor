<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.neighbor.mapper.ReplyMapper">
    
    <!-- 보드아이디로 모든 reply정보 가져오기 -->
    <select id="selectAllByBoardId" resultType="replyVO">
        select reply_id, reply_content, reply_score, reply_register_date, reply_update_date, member_id, board_id
        from tbl_reply where board_id = #{boardId};
    </select>

    <!--후기관리 글 삭제-->
    <delete id="delete">
        delete from tbl_reply
        where reply_id=#{replyId}
    </delete>

    <!--대시보드 후기글 부분 조회-->
    <select id="selectAllBy" resultType="replyDTO">
        select reply_id, reply_content, reply_score, reply_register_date, reply_update_date, r.member_id, board_id, member_nickname
        from tbl_member m join tbl_reply r
        on m.member_id = r.member_id order by reply_id desc
        limit 5
    </select>

    <!--후기 총 수-->
    <select id="countAll" resultType="int">
        select count(distinct reply_id) as countTotalReplys
        from tbl_reply
    </select>

    <!--후기 전체 조회 검색 포함-->
    <select id="selectAll" resultType="replyDTO">
        select r.reply_id, r.board_id, b.board_region, m.member_nickname, r.reply_content, r.reply_register_date
        from tbl_reply as r
        join tbl_board as b on r.board_id = b.board_id
        join tbl_member as m on r.member_id = m.member_id
<!--        <if test="keyword != null">
            where r.reply_content like concat('%',#{keyword}, '%')
        </if>-->
        order by reply_id desc
        limit #{criteria.offset}, #{criteria.amount}
    </select>
</mapper>